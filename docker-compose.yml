version: "3.9"

services:
  app:
    build: .
    container_name: lotr-rag
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - LLM_MODEL_NAME=${LLM_MODEL_NAME:-gpt-4.1-mini}
      - EMBEDDING_MODEL_NAME=${EMBEDDING_MODEL_NAME:-text-embedding-3-small}
      - VECTOR_STORE_BACKEND=${VECTOR_STORE_BACKEND:-chroma}
      - VECTOR_STORE_PATH=${VECTOR_STORE_PATH:-/app/data/vector_store}
      - CORPUS_DIR=${CORPUS_DIR:-/app/data/corpus}
      - RELEVANCE_THRESHOLD=${RELEVANCE_THRESHOLD:-0.78}
      - MIN_GOOD_CHUNKS=${MIN_GOOD_CHUNKS:-2}
      - MAX_CONTEXT_CHUNKS=${MAX_CONTEXT_CHUNKS:-5}
      - CHUNK_SIZE_CHARS=${CHUNK_SIZE_CHARS:-1000}
      - CHUNK_OVERLAP_CHARS=${CHUNK_OVERLAP_CHARS:-200}
      - ADMIN_TOKEN=${ADMIN_TOKEN}
      - APP_HOST=0.0.0.0
      - APP_PORT=8000
    volumes:
      - ./data/vector_store:/app/data/vector_store
      - ./data/corpus:/app/data/corpus:ro
    ports:
      - "8000:8000"
    command: ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
    restart: unless-stopped
